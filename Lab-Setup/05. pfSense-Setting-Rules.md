# ğŸ” pfSense Configuration for Cybersecurity Lab

This guide explains how to configure **pfSense Firewall** after installing it.  
The goal is to create:
- ğŸ–¥ï¸ **Target LAN** (Windows 11 target machine)
- âš”ï¸ **Attack LAN** (Kali Linux attacker machine)
- ğŸŒ **WAN** connection (pfSense linked to the internet)

---

## ğŸŒ Network Diagram

Below is a simple diagram of the lab setup:

          ğŸŒ Internet
              â”‚
              â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  WAN     â”‚ (Bridged Adapter)
          â”‚ pfSense  â”‚ 10.0.1.1
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         /             \
        /               \
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Target LAN     â”‚ â”‚ Attack LAN     â”‚
    â”‚ Windows 11     â”‚ â”‚ Kali Linux     â”‚
    â”‚ IP: 10.0.1.2   â”‚ â”‚ IP: 10.0.3.x   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
- **WAN:** Connects pfSense to your real home/office network for internet access.
- **Target LAN (10.0.1.x):** Contains Windows 11 VM (the victim network).
- **Attack LAN (10.0.3.x):** Contains Kali Linux VM (used for penetration testing).
- pfSense acts as a **router + firewall** between these networks.

---

## ğŸŒ Step 1: Access pfSense Web Interface
1. On your **Windows 11 VM**, open **Microsoft Edge**.
2. Enter the pfSense firewall IP:  
```
https://10.0.1.1
```

3. A warning appears (because pfSense uses a self-signed certificate).  
- Click **Advanced â†’ Accept the Risk & Continue**.
4. Login using default credentials:  
- **Username:** `admin`  
- **Password:** `pfsense`

---

## âš™ï¸ Step 2: Initial Setup Wizard
- Click **Next â†’ Next**.
- (Optional) Change the **Hostname** and **Domain** if you wish.
- **Uncheck:** â€œOverride DNSâ€ â†’ Click **Next**.
- Change the **Time Zone** â†’ Click **Next**.
- Scroll down and **Uncheck:** â€œBlock RFC1918 Private Networksâ€ â†’ Click **Next**.  
*(We uncheck this so our private lab networks can communicate.)*
- Leave other values as default â†’ Click **Next**.
- Change the **Admin Password** â†’ Click **Next â†’ Reload â†’ Finish â†’ Close**.

---

## ğŸ·ï¸ Step 3: Rename Interfaces
1. Go to **Interfaces â†’ LAN**:
- Change description to: `Target LAN` â†’ **Save â†’ Apply Changes**.
2. Go to **Interfaces â†’ OPT1**:
- Change description to: `Attack LAN` â†’ **Save â†’ Apply Changes**.

---

## ğŸŒ Step 4: Configure DNS Resolver
1. Go to **Services â†’ DNS Resolver**.
2. Scroll to the bottom:
- âœ… Check **DHCP Registration**.
- âœ… Check **Static DHCP**.
3. Scroll up â†’ Click **Advanced Settings**.
4. Enable:
- âœ… **Prefetch Support**
- âœ… **Prefetch DNS Key Support**
5. Scroll down â†’ **Save â†’ Apply Changes**.

âœ… *This ensures pfSense resolves DNS queries quickly for both LANs.*

---

## âš¡ Step 5: Networking Optimization
1. Go to **System â†’ Advanced â†’ Networking**.
2. Enable **Hardware Checksum Offloading** â†’ **Save â†’ OK**.
3. Login again with the new password (if prompted).

---

## ğŸ“œ Step 6: DHCP Leases (Assigning IPs)
1. Go to **Status â†’ DHCP Leases**.
2. Find the IP assigned to **Windows 11 VM**.
3. Click the **+ (Add)** icon under **Actions**.
4. Set IP to: `10.0.1.2` â†’ **Save â†’ Apply Changes**.
5. On Windows 11, open **Command Prompt**:
```bash
ipconfig /release
ipconfig /renew
```

âœ… We assigned a fixed IP to keep the target machine consistent for scans and attacks.

## ğŸ†” Step 7: Create an Alias for Private IPs
1. Go to Firewall â†’ Aliases â†’ Add.
2. Fill in the following:
   - Name: RFC1918
   - Description: Private IPv4 Address Space
   - Type: Network
3. Add these ranges:

   ```
    10.0.0.0/8
    172.16.0.0/12
    192.168.0.0/24
   ```

4. Save â†’ Apply Changes.
âœ… Aliases group private IP ranges so we can create firewall rules more easily.

---

## ğŸ”¥ Step 8: Create Firewall Rules
ğŸ”‘ Important:
pfSense applies rules Top â†’ Down.

ğŸ‘‰ The first rule that matches traffic takes effect.


### 8.1 Target LAN Rules

These rules control traffic for the Target LAN (Windows 11).

âœ… Rule 1: Allow Internal Traffic
- Action: Pass
- Interface: Target LAN
- Address Family: IPv4+IPv6
- Protocol: Any
- Source: Target LAN
- Destination: Target LAN
- Description: Allow traffic to all devices within Target LAN

â¡ï¸ Reason: Devices inside the Target LAN must communicate freely.


âœ… Rule 2: Allow Target â†” Attack LAN Communication
- Action: Pass
- Interface: Target LAN
- Address Family: IPv4+IPv6
- Protocol: Any
- Source: Target LAN
- Destination: Attack LAN
- Description: Allow communication between Target LAN and Attack LAN

â¡ï¸ Reason: This lets the attacker machine (Kali) interact with the target (Windows 11) for testing.


âœ… Rule 3: Allow Target LAN Internet Access
- Action: Pass
- Interface: Target LAN
- Address Family: IPv4+IPv6
- Protocol: Any
- Source: Target LAN
- Destination: Address or Alias â†’ RFC1918 (Invert Match âœ…)
- Description: Allow traffic to non-private (Internet)

â¡ï¸ Reason: Allows the target machine to reach the internet while blocking private subnets.

ğŸš« Rule 4: Block Everything Else
- Action: Block
- Interface: Target LAN
- Address Family: IPv4+IPv6
- Protocol: Any
- Source: Target LAN
- Destination: Any
- Description: Block all unspecified traffic

â¡ï¸ Reason: A default block rule for extra security.

---

### 8.2 Attack LAN Rules

These rules control traffic for the Attack LAN (Kali).

âœ… Rule 1: Allow Attack LAN â†’ Target LAN
- Action: Pass
- Interface: Attack LAN
- Address Family: IPv4
- Protocol: Any
- Source: Attack LAN
- Destination: Target LAN
- Description: Allow traffic from Attack LAN to Target LAN

â¡ï¸ Reason: Kali needs access to the target machine to run tests.

ğŸš« Rule 2: Block Attack LAN Internet Access
- Action: Block
- Interface: Attack LAN
- Address Family: IPv4+IPv6
- Protocol: Any
- Source: Attack LAN
- Destination: Address or Alias â†’ RFC1918 (Invert Match âœ…)
- Description: Block internet access from Attack LAN

â¡ï¸ Reason: Prevents the attacker machine from reaching the internet for safety.
> ğŸ‘‰ If you ever need internet on Kali (e.g., to update tools), youâ€™ll have to temporarily disable this rule.

ğŸš« Rule 3: Block Attack LAN â†’ WAN Subnets
- Action: Block
- Interface: Attack LAN
- Address Family: IPv4+IPv6
- Protocol: Any
- Source: Attack LAN
- Destination: WAN Subnets
- Description: Block traffic from Attack LAN to WAN

â¡ï¸ Reason: Prevents the attacker machine from interfering with WAN networks.

---

## ğŸ”„ Step 9: Final Step â€“ Reboot pfSense

Go to Diagnostics â†’ Reboot â†’ Normal Reboot â†’ Submit.

âœ… pfSense is now fully configured for your lab environment.

---

## ğŸ“ Summary
- ğŸŸ¢ Target LAN (Windows 11) can reach the internet and communicate with Attack LAN.
- ğŸ”´ Attack LAN (Kali) can only reach Target LAN (no internet).
- ğŸ”’ All other traffic is blocked for security.

This configuration simulates a real-world segmented network for practicing:
- ğŸ›¡ï¸ Firewall management
- ğŸ”¥ Rule-based network security
- âš”ï¸ Penetration testing scenarios

---
