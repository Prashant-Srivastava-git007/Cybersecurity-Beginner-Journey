# üîé Filesystem Analysis ($MFT and $J)  ‚Äî 

---

## ‚è±Ô∏è NTFS Timestamps (MACB)
NTFS records several timestamps for each file. These are essential for building timelines:

- **M** ‚Äî **Modified** (content last changed)  
- **A** ‚Äî **Accessed** (file was read)  
- **C** ‚Äî **Metadata Changed** (attributes, permissions, or rename ‚Äî MFT record updated)  
- **B** ‚Äî **Birth / Created** (when file was created)

> Note: You will often see these written as **MACB** or **MACB timestamps**.  
> Timestamps can be altered by attackers ‚Äî always correlate with other artifacts (event logs, Prefetch, Registry).

---

## üîê $STANDARD_INFO vs $FILE_NAME
NTFS stores timestamp and metadata in two different attributes:

- **$STANDARD_INFORMATION ($SI)**  
  - Stores flags, owner SID and **MACB timestamps**.  
  - Can be modified by user-level tools (e.g., timestomp).
- **$FILE_NAME**  
  - Also stores MACB times, file name, and length.  
  - **Only the kernel can modify this.**  
  - Because of that, `$FILE_NAME` timestamps are generally more reliable ‚Äî attackers rarely can change them without low-level access.

---

## üóÇÔ∏è Master File Table (MFT)
The **MFT** is the NTFS database of all files and folders. 
**Key points:**
- **Metadata Storage:** Every file/folder has an MFT record with timestamps, size, attributes, and pointers to file data.  
- **Indexing & Allocation:** Tracks where file data is stored on disk.  
- **MFT Zone:** Area reserved for future MFT growth; fragmentation here can indicate heavy file activity.  
- **Alternate Data Streams (ADS):** Files can have hidden streams (e.g., `file.txt:secret`) that may contain extra data or covert content. ADS are stored via MFT and must be checked.
- **Resilience:** filesystem‚Äôs ability to withstand errors, crashes, or corruption and recover so data and metadata remain intact and usable

---

## ‚öôÔ∏è Tool Used ‚Äî MFTECmd by Eric Zimmerman

**MFTECmd** is a free, command-line tool developed by **Eric Zimmerman** to parse and analyze MFT data easily.  

---

## üß≠ Steps to Analyze MFT

### **Step 1: Open Command Prompt**
- Open the **Command Prompt** (`cmd`) as Administrator.
- Navigate to the folder where you extracted the **MFTECmd.exe** tool.

```bash
cd path\to\MFTECmd
```

### Step 2: Run the MFTECmd Command
- Use the following syntax to generate a CSV report:

```bash
MFTECmd.exe -f "C:\Path\To\$MFT" --csv "C:\Path\To\OutputFolder" --csvf "MFT.csv"
```

---

## üß© Command Breakdown

| Part                              | Meaning                                                        |
| --------------------------------- | -------------------------------------------------------------- |
| **MFTECmd.exe**                   | The executable tool for MFT analysis.                          |
| **-f C:\Users...$MFT**            | Specifies the **input file** ‚Äî the MFT to be analyzed.         |
| **--csv C:\Users...\File_System** | Defines the **output folder** where the results will be saved. |
| **--csvf MFT.csv**                | Names the **output CSV file** (e.g., `MFT.csv`).               |

--- 

## üß© Analyzing MFT Entries Using Timeline Explorer

### üîç Step 1: Open the MFT CSV in Timeline Explorer

After generating your MFT CSV file (for example, using `MFTECmd`), you can view it in **Timeline Explorer** for easier filtering and searching.

**Steps:**
1. Navigate to the **Timeline Explorer** folder.  
2. Double-click `TimelineExplorer.exe` to open the tool.  
3. Click **File ‚Üí Open**, and select your `MFT.csv` file.  
4. Once loaded, use the **Find (Ctrl + F)** feature to search within the CSV.

> üß† Example: Search for a suspicious script like  
> **`ART-attack.ps1`** or any keyword such as **`attack`**, **`.exe`**, or **`.bat`** to quickly locate related file activities.

Timeline Explorer provides an easy-to-read interface that helps investigators **sort**, **filter**, and **analyze file events chronologically**.

### ‚öôÔ∏è Step 2: Extract Specific MFT Entry Using MFTECmd

Once you identify a suspicious file (for example, `ART-attack.ps1`) and note its **Entry Number** from the CSV,  
you can use **MFTECmd** to extract detailed information about that specific MFT record.

### üñ•Ô∏è Command Syntax

```bash
MFTECmd.exe -f "C:\Path\To\$MFT" --de <EntryNumber>
```

---

## üßæ USN Journal Analysis ($J)

The **USN Journal ($J)** is part of the NTFS file system.  
It records **every change made to files and folders** ‚Äî such as creation, deletion, renaming, or attribute modifications.

Even if **MFT timestamps are disabled or altered**, the USN Journal can still reveal **what happened and when**.

---

## üîç Why Analyze the USN Journal?

USN Journal analysis can provide evidence of hidden or deleted file activity.  
Here are common forensic use cases:

- ‚úÖ Confirm that a file **existed** on the system.  
- üóëÔ∏è Identify **file deletions** and when they occurred.  
- üïµÔ∏è Detect when **Prefetch files** were deleted (and which ones).  
- üîÑ See when users **overwrote files before deletion** (common in anti-forensic techniques).  
- üìÇ Locate **staging directories** used before exfiltration or archiving.  
- ü¶† Detect when **malware hid files** using hidden/system attributes.  

> üí° **Tip:** The USN Journal can reveal traces of deleted or hidden files even if the files themselves are gone.

---

## üß≠ Steps to Analyze the USN Journal ($J)

### Step 1: Open Command Prompt
Run **Command Prompt** as Administrator and navigate to the folder containing `MFTECmd.exe`:

```bash
cd path\to\MFTECmd
```

### Step 2: Run the MFTECmd Command

Use the following syntax to process the $J file and generate a CSV report:

```bash
MFTECmd.exe -f "C:\Path\To\$Extend\$J" -m "C:\Path\To\$MFT" --csv "C:\Path\To\OutputFolder" --csvf "$J.csv"
```

> Note:- Analysing USN Journal ($J) is same as analysing MFT.

---
