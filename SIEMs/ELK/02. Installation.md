# Elastic Stack Installation Guide

This guide explains how to install and set up the **Elastic Stack (Elasticsearch + Kibana)** on a Linux system.  

---

## Prerequisites

- A Linux system (physical or virtual)
- Internet access
- Sudo/root privileges

---

## Step 1: Install the Base System

Download and install **Kali Purple** from the official site:  
https://www.kali.org/get-kali/#kali-installer-images

> Kali Purple is preconfigured for security monitoring and works well with Elastic.

---

## Step 2: Configure Network (Static IP)

Set a static IP during or after installation.

Example:
- IP Address: `192.168.31.5`
- Gateway: `192.168.31.1`
- Netmask: `255.255.255.0`

> A static IP ensures Elastic services remain reachable.

---

## Step 3: Update the System

```bash
sudo apt update && sudo apt upgrade -y
````

**What this does:**
Updates package lists and installs the latest system updates.

---

## Step 4: Install Elasticsearch

```bash
sudo bash -c "export HOSTNAME=kali-purple.kali.purple; apt-get install elasticsearch -y"
```

**What this does:**

* Sets a hostname for Elastic services
* Installs Elasticsearch

ðŸ“Œ **Important:**
After installation, Elasticsearch generates a **password**.
Copy this password and save it in a text file. You will need it later.

Also note down your systemâ€™s **IP address**.

---

## Step 5: Update Hosts File

```bash
sudo nano /etc/hosts
```

Add this line (replace `<Server-IP>` with your system IP):

```text
<Server-IP> kali-purple.kali.purple
```

**What this does:**
Maps the hostname to your system IP for proper service communication.

---

## Step 6: Enable and Start Elasticsearch

```bash
sudo systemctl daemon-reload
sudo systemctl enable elasticsearch.service
sudo systemctl start elasticsearch.service
```

**What this does:**

* Reloads service definitions
* Enables Elasticsearch at boot
* Starts the Elasticsearch service

---

## Step 7: Configure Elasticsearch as Single Node

```bash
sudo sed -e '/cluster.initial_master_nodes/ s/^#*/#/' -i /etc/elasticsearch/elasticsearch.yml
echo "discovery.type: single-node" | sudo tee -a /etc/elasticsearch/elasticsearch.yml
```

**What this does:**
Configures Elasticsearch to run as a **single-node cluster**, ideal for learning and labs.

---

## Step 8: Install Kibana

```bash
sudo apt install kibana -y
```

**What this does:**
Installs Kibana, the visualization interface for Elasticsearch.

---

## Step 9: Generate Kibana Encryption Keys

```bash
sudo /usr/share/kibana/bin/kibana-encryption-keys generate -q
```

**What this does:**
Generates encryption keys required for Kibana security features.

---

## Step 10: Configure Kibana Host

```bash
echo "server.host: \"kali-purple.kali.purple\"" | sudo tee -a /etc/kibana/kibana.yml
```

**What this does:**
Binds Kibana to the configured hostname.

---

## Step 11: Enable and Restart Services

```bash
sudo systemctl enable elasticsearch kibana --now
sudo systemctl restart elasticsearch
```

**What this does:**
Starts Elasticsearch and Kibana and enables them at boot.

---

## Step 12: Enroll Kibana with Elasticsearch

```bash
sudo /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana
```

**What this does:**
Creates a **temporary enrollment token** to securely connect Kibana to Elasticsearch.

ðŸ“Œ Copy the token.

If you get an error, restart Elasticsearch:

```bash
sudo systemctl restart elasticsearch
```

---

## Step 13: Access Kibana (Initial Setup)

Open a browser and go to:

```text
http://<your-ip>:5601
```

* Paste the enrollment token
* You will be asked for a verification code

Generate the code:

```bash
sudo /usr/share/kibana/bin/kibana-verification-code
```

Paste the code into the browser.

---

## Step 14: Enable HTTPS for Kibana

### Create Certificate Authority

```bash
sudo /usr/share/elasticsearch/bin/elasticsearch-certutil ca
```

**What this does:**
Creates a certificate authority for Elastic services.

Press **Enter** to accept defaults.

---

### Generate Kibana Certificate

```bash
sudo /usr/share/elasticsearch/bin/elasticsearch-certutil cert \
--ca elastic-stack-ca.p12 \
--dns kali-purple.kali.purple,kali-purple \
--out kibana-server.p12
```

**What this does:**
Creates SSL certificates for Kibana.

---

### Convert Certificates

```bash
sudo openssl pkcs12 -in /usr/share/elasticsearch/elastic-stack-ca.p12 -clcerts -nokeys -out /etc/kibana/kibana-server_ca.crt
sudo openssl pkcs12 -in /usr/share/elasticsearch/kibana-server.p12 -out /etc/kibana/kibana-server.crt -clcerts -nokeys
sudo openssl pkcs12 -in /usr/share/elasticsearch/kibana-server.p12 -out /etc/kibana/kibana-server.key -nocerts -nodes
```

**What this does:**
Extracts certificate and key files needed by Kibana.

---

### Set Permissions

```bash
sudo chown root:kibana /etc/kibana/kibana-server*
sudo chmod 660 /etc/kibana/kibana-server*
```

**What this does:**
Ensures Kibana can securely access SSL files.

---

### Enable SSL in Kibana

```bash
echo "server.ssl.enabled: true" | sudo tee -a /etc/kibana/kibana.yml
echo "server.ssl.certificate: /etc/kibana/kibana-server.crt" | sudo tee -a /etc/kibana/kibana.yml
echo "server.ssl.key: /etc/kibana/kibana-server.key" | sudo tee -a /etc/kibana/kibana.yml
```

---

## Step 15: Add Encryption Keys to Kibana

```bash
sudo /usr/share/kibana/bin/kibana-encryption-keys generate
```

Copy the keys.

Open the config file:

```bash
sudo nano /etc/kibana/kibana.yml
```

Paste the keys at the bottom and save.

---

## Step 16: Restart Kibana

```bash
sudo systemctl restart kibana
```

---

## Step 17: Access Elastic Securely

Open your browser:

```text
https://<your-ip>:5601
```

* Click **Advanced**
* Accept the risk (self-signed certificate)

Login with:

* **Username:** `elastic`
* **Password:** (the one you saved earlier)

---

## Installation Complete

You now have a working **Elastic Stack with HTTPS enabled**, ready for learning, logging, and SIEM use cases.

![Dashboard](Assets/ELK-Dashboard.png)

---
